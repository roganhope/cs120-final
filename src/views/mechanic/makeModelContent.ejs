<h1 class="page-title">
    <%= data.make %>
        <%= data.model %>
</h1>

<div class="model-img-container">

    <% if (data.image) { %>
        <img id="makemodelimg" src="<%= data.image %>" alt="">
        <% } else { %>
            <img id="makemodelimg" src="/images/unknown-scooter.png" alt="">
            <% } %>
</div>



<div class="button-container">
    <button id="uploadButton">Upload Image</button>
</div>

<div class="section-container" id="uploadSection" style="display: none;">
    <form action="/update-model-image" class="upload-image" id="uploadForm" method="post" enctype="multipart/form-data">
        <input type="file" name="image" id="imageInput">
        <input type="hidden" name="data" value="<%= data %>">
        <input type="hidden" name="make" value="<%= data.make %>">
        <input type="hidden" name="model" value="<%= data.model %>">
        <button type="submit">Submit</button>
    </form>
</div>


<div class="section-container">
    <h2 class="section-title">Mechanic Notes</h2>
    <form action="/updatemechanicnotes/<%= data.make %>/<%= data.model %>" method="post">
        <input type="hidden" name="make" value="<%= data.make %>">
        <input type="hidden" name="model" value="<%= data.model %>">

        <textarea id="mechanic_notes" name="mechanic_notes" readonly>
                    <% if (data.mechanic_notes) { %>
                        <%= data.mechanic_notes %>
                    <% } %>
                </textarea>
        <br><br>

        <button type="button" id="editButton">Edit</button>
        <button type="button" id="translateButton">Translate To English </button>
        <button type="button" id="translateToSpanish">Translate To Spanish </button>
        <button type="submit" id="submitButton" style="display: none;">Submit</button>
        <button type="button" id="cancelButton" style="display: none;">Cancel</button>
    </form>
</div>




<script>
    document.addEventListener('DOMContentLoaded', function() {
        var editButton = document.getElementById('editButton');
        var submitButton = document.getElementById('submitButton');
        var cancelButton = document.getElementById('cancelButton');
        var form = document.getElementById('mechanic_notes_form');
        var textarea = document.getElementById('mechanic_notes');
        const translateButton = document.getElementById('translateButton');
        const translateToSpanishButton = document.getElementById('translateToSpanish');

         // Translate button functionality
         translateToSpanishButton.addEventListener('click', function () {
            console.log("Translate to spansih button pressed")
            const mechanicNotes = textarea.value;
            const xhr = new XMLHttpRequest();
            xhr.open('POST', '/translate/to/spanish', true);
            xhr.setRequestHeader('Content-Type', 'application/json');

            xhr.onreadystatechange = function() {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        console.log(xhr.responseText);
                        const response = JSON.parse(xhr.responseText);
                        console.log(response)
                        if (response.translatedText) {
                            const translatedText = response.translatedText.trans; 
                            console.log('Translated text:', translatedText);
                            addTranslatedDiv(translatedText)
                        }
                    } else {
                        console.error('Request failed');
                    }
                }
            };
            xhr.send(JSON.stringify({ text: mechanicNotes }));
        });

        translateButton.addEventListener('click', function () {
            console.log("Translate to enlgish button pressed")
            const mechanicNotes = textarea.value;
            const xhr = new XMLHttpRequest();
            xhr.open('POST', '/translate/to/english', true);
            xhr.setRequestHeader('Content-Type', 'application/json');

            xhr.onreadystatechange = function() {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        console.log(xhr.responseText);
                        const response = JSON.parse(xhr.responseText);
                        console.log(response)
                        if (response.translatedText) {
                            const translatedText = response.translatedText.trans; 
                            console.log('Translated text:', translatedText);
                            addTranslatedDiv(translatedText)
                        }
                    } else {
                        console.error('Request failed');
                    }
                }
            };
            xhr.send(JSON.stringify({ text: mechanicNotes }));
        });

        editButton.addEventListener('click', function () {
            editButton.style.display = 'none';
            submitButton.style.display = 'inline-block';
            cancelButton.style.display = 'inline-block';
            textarea.removeAttribute('readonly');
        });

        // Cancel button functionality
        cancelButton.addEventListener('click', function () {
            location.reload(); // Refresh the page
        });

        // Form submission handling
        form.addEventListener('submit', function (event) {
            event.preventDefault();
            form.submit();
        });

        // Upload photo functionality
        const uploadButton = document.getElementById('uploadButton');
        const uploadSection = document.getElementById('uploadSection');
        uploadButton.addEventListener('click', function () {
            uploadButton.style.display = 'none';
            uploadSection.style.display = 'block';
        });

       
    });

    function addTranslatedDiv(translatedText) {
    const pageContentContainer = document.getElementById('pageContentContainer');

    if (pageContentContainer) { // Ensure the container exists
        // Create a new div element to contain the translated text
        const translatedDiv = document.createElement('div');
        translatedDiv.classList.add('section-container'); // Add necessary classes

        // Create a heading for the translated text
        const translatedHeading = document.createElement('h2');
        translatedHeading.classList.add('section-title');
        translatedHeading.textContent = 'Translated Notes';

        // Create a paragraph for the translated text content
        const translatedParagraph = document.createElement('p');
        translatedParagraph.textContent = translatedText;

        // Append heading and paragraph to the translated div
        translatedDiv.appendChild(translatedHeading);
        translatedDiv.appendChild(translatedParagraph);

        // Append the translated div to the page content container
        pageContentContainer.appendChild(translatedDiv);
    } else {
        console.error('Page content container not found.');
    }
}

</script>

